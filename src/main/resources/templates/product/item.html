<!DOCTYPE html>
<html lang=" utf-8"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 등록 페이지</title>
</head>
</head>
<link rel="stylesheet" href="/css/nav.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/login.css">

<body>
<div class="navbar" >
    <ul id="logo_text">
        <li><a th:href = "@{/toyproject_one/admin_main}" >Shopping Mall</a></li>
    </ul>
    <ul id="menu">
        <li><a th:href = "@{/toyproject_one/ad_main}">로그아웃</a></li>
    </ul>
    <br><br><br>
    <nav class="navbar navbar-inverse">
        <div id="menu2">
            <ul class="main1">
                <li style="border: none; ">
                    <a href="#"><b style="font-size: 20px;"><span style="font-size: 20px;">≡</span> Product</b></a>
                    <ul class="main2">
                        <li><a class="active" th:href = "@{/toyproject_one/item}">상품 등록</a></li>
                        <li><a th:href = "@{/toyproject_one/item/list}">상품 목록</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
</div>

<br><br><br><br>

<form th:action="@{/toyproject_one/item}" method="post" modelAttribute="itemDTO" enctype="multipart/form-data">
    <div style="text-align: center;">
        <table style="width: 35%; border: 1px solid #dddddd; margin: 0 auto;">
        <p class="tip"></p>
    <!--    <div class="cont">-->
            <thead>
                <tr>
                    <th class="navbar" colspan="2" style="background-color: #eeeeee; text-align: center;">
                        <h2 style="margin: 0;">상품 등록</h2>
                    </th>
                  </tr>
            </thead>

            <tbody>
            <div style="display: flex; justify-content: left;">

                <tr>
                    <td style="width: 25%; text-align: left;">  상품코드</td>
                    <td style="width: 75%; text-align: left;">
                        <input class="font" type="text" id="item_id" name="item_id" style="display: block; width: 350px; margin: 0 auto;" readonly>
                        <script>
                            // 현재 시간을 가져오는 함수
                            function getCurrentDateTime() {
                                var now = new Date();
                                var month = now.getMonth() + 1;
                                var day = now.getDate();
                                var hour = now.getHours();
                                var minute = now.getMinutes();

                                // 한 자리 숫자인 경우 앞에 0을 추가
                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hour < 10) hour = '0' + hour;
                                if (minute < 10) minute = '0' + minute;

                                return 'P' + month + day + hour + minute;
                            }

                            // 현재 시간을 가져와서 상품 코드에 설정
                            document.getElementById('item_id').value = getCurrentDateTime();
                        </script>
                        <span th:text="${valid_item_id}" style="color: #c20c0c;"></span>
                    </td>
                </tr>

                <tr>
                    <td style="text-align: left;">  이미지 업로드</td>
                    <td style="text-align: left;">
                        <input class="font" type="file" id="item_img_id" name="item_img_id"  accept="image/*" style="display: block; width: 350px; margin: 0 auto;" />
<!--                        <button type="submit">Upload Image</button>-->
                        <span th:text="${valid_item_img_id}" style="color: #c20c0c;"></span>
                    </td>
                </tr>

                <tr>
                    <td style="text-align: left;">  상품명</td>
                    <td style="text-align: left;">
                        <input class="font" type="text" id="item_nm" name="item_nm" style="display: block; width: 350px; margin: 0 auto;" />
                        <span th:text="${valid_item_nm}" style="color: #c20c0c;"></span>
                    </td>
                </tr>

                <tr>
                    <td style="text-align: left;">  가격</td>
                    <td style="text-align: left;">
                        <input class="font" type="text" id="price" name="price" oninput="formatNumber(this)" style="display: block; width: 350px; margin: 0 auto;" />
                        <span th:text="${valid_price}" style="color: #c20c0c;"></span>
                    </td>

                    <script>
                        function formatNumber(input) {
                            // 입력값에서 숫자만 추출
                            let num = input.value.replace(/\D/g, "");

                            // 최대 9자리까지만 유지
                            num = num.substring(0, 7);

                            // 쉼표(,) 삽입
                            num = num.replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                            // 입력값 업데이트
                            input.value = num;
                        }
                    </script>
                </tr>

                <tr>
                    <td style="text-align: left;">  재고수량</td>
                    <td style="text-align: left;">
                        <input class="font" type="text" id="stock_number" name="stock_number" style="display: block; width: 350px; margin: 0 auto;" oninput="updateSellStatus()" />
                        <span th:text="${valid_stock_number}" style="color: #c20c0c;"></span>
                    </td>
                </tr>

                <tr>
                    <td style="text-align: left;">  상품 상세 설명</td>
                    <td style="text-align: left;">
                        <textarea id="item_detail" name="item_detail" style="display: block; width: 350px; margin: 0 auto;" maxlength="255" oninput="updateByteCount(this)"></textarea>
                    </td>
                </tr>

                <script>
                    function updateByteCount(element) {
                        const maxLength = 255;
                        const text = element.value;
                        let byteCount = 0;

                        for (let i = 0; i < text.length; i++) {
                            const charCode = text.charCodeAt(i);
                            if ((charCode >= 0x0001 && charCode <= 0x007E) || (charCode >= 0xAC00 && charCode <= 0xD7A3)) {
                                byteCount += 1;
                            } else {
                                byteCount += 2;
                            }
                        }

                        if (byteCount > maxLength * 2) {
                            // 한글 2바이트, 영문 1바이트로 계산되므로 최대 바이트의 두 배를 초과하는 경우 처리
                            byteCount = maxLength * 2;
                        }

                        const remaining = maxLength - Math.floor(byteCount / 2);
                        document.getElementById("byteCount").innerText = remaining + " bytes remaining";
                    }
                </script>

                <tr>
                    <td style="text-align: left;">상품 판매 상태</td>
                    <td style="width: 75%; text-align: left;">
                        <input class="font" type="text" id="item_sell_status" name="item_sell_status" style="display: block; width: 350px; margin: 0 auto;" readonly>
                <script>
                    // 페이지가 로드될 때 판매 상태 업데이트
                    window.onload = function() {
                        updateSellStatus();
                    };

                    function updateSellStatus() {
                        var stockNumber = document.getElementById("stock_number").value;
                        var sellStatusInput = document.getElementById("item_sell_status");

                        if (stockNumber.trim() !== "") {
                            if (parseInt(stockNumber) >= 1) {
                                sellStatusInput.value = "판매중";
                            } else {
                                sellStatusInput.value = "품절";
                            }
                        } else {
                            sellStatusInput.value = ""; // 재고수량이 입력되지 않은 경우 입력란을 비웁니다.
                        }
                    }
                </script>
                <span th:text="${valid_item_sell_status}" style="color: #c20c0c;"></span>
                    </td>
                </tr>
            </div>
            </tbody>
        </table>
    </div>

    <button class="background" type = "submit" >상품 등록</button>

</form>
</body>
</html>