<!DOCTYPE html>
<html lang=" utf-8"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/product_write.css">
    <title>회원가입 페이지</title>
    <!-- Jquery CDN-->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <div style="text-align: center;">
                <br>
                <li class="nav-item" style="padding-left: 30px; height: 60px;">
                    <a class="nav-link" style="padding-left: 10px; padding-right: 10px;" href="#" id="adminLink">Shopping
                        Mall</a>
                </li>
                <img src="/img/logo.jpg" alt="Logo" style="max-height: 80px; max-width: 350px;">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/toyproject_one/login}">로그인</a>&nbsp;&nbsp;&nbsp;
                        <a class="nav-link" th:href="@{/toyproject_one/signup}">회원가입</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <br>
    <div style="text-align: center; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; padding: 10px 0;">
        <div>
            <a class="menu active" th:href="@{/toyproject_one/main}"> Home</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list}"> All</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list/Outer}"> Outer</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list/Top}"> Top</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list/Bottom}"> Bottom</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list/Dress}"> Dress</a>
            <a class="menu " th:href="@{/toyproject_one/us_item/list/Accessories}"> Accessories</a>
            <a class="menu " th:href="@{/toyproject_one/us_board}"> 상품후기</a>
            <a class="menu " th:href="@{/toyproject_one/us_board}"> Q&A</a>
            <form th:action="@{/toyproject_one/us_item/list}" method="get" style="display: inline-block;">
                <button class="menu " type="submit">상품명 검색</button>
                <input type="text" name="searchKeyword">
            </form>
        </div>
    </div>
</header>
<br><br><br>

<form th:action="@{/toyproject_one/signup}" method="post" modelAttribute="userDTO">
    <p class="tip"></p>
    <div style="display: flex; justify-content: center; align-items: center; height: 50vh;">
        <table style="text-align: center;">
            <tr>
                <td style="text-align: right; width: 200px;"></td>
                <td>
                    <div class="cont">
                        <div class="form sign-in">
                            <h2>Sign UP</h2>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="userID">아이디</label>
                    <label style="color: #c20c0c;">*</label>&nbsp;
                </td>
                <td>
                    <input class="font" type="text" MAXLENGTH="15" onkeyup="idCheck()" id="userID" name="userID"
                           placeholder="  아이디" style="width: 350px;" required/>
                    <span id="userID_error" style="color: #c20c0c;"></span>
                    <span id="user_check-result" style="color: #c20c0c;"></span>
                </td>
            </tr>
            <script th:inline="javascript">
                const idCheck = () => {
                    const userID = document.getElementById("userID").value;
                    const checkResult = document.getElementById("user_check-result");
                    console.log("입력값: ", userID);

                    // 아이디가 영문, 숫자, 밑줄(_)로만 구성되는지 확인
                    const idRegex = /^[a-zA-Z0-9_]+$/;
                    if (!idRegex.test(userID)) {
                        console.log("아이디는 영문, 숫자, _ 로만 구성되어야 합니다.");
                        checkResult.innerHTML = "아이디는 영문, 숫자, _ 로만 입력 가능합니다.";
                        return; // 조건에 맞지 않으면 함수 종료
                    }

                    // 길이 확인 추가
                    if (userID.length < 5 || userID.length > 15) {
                        console.log("아이디는 5자 이상 15자 이하여야 합니다.");
                        checkResult.innerHTML = "아이디는 5자 이상 15자 이하로만 입력 가능합니다.";
                        return; // 길이가 조건에 맞지 않으면 함수 종료
                    }

                    $.ajax({
                        type: "post",
                        url: "/toyproject_one/signup/id_check",
                        data: {
                            "userID": userID
                        },
                        success: function(res) {
                            console.log("요청성공", res);
                            if (res == "ok") {
                                console.log("사용가능한 아이디입니다.");
                                checkResult.innerHTML = "사용가능한 아이디입니다.";
                            } else {
                                console.log("이미 사용중인 아이디입니다.");
                                checkResult.innerHTML = "이미 사용중인 아이디입니다.";
                            }
                        },
                        error: function(err) {
                            console.log("에러발생", err);
                        }
                    });
                }
            </script>

            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_pw">비밀번호</label>
                    <label style="color: #c20c0c;">*</label>&nbsp;
                </td>
                <td>
                    <input class="font" type="password" id="user_pw" name="user_pw" placeholder="  비밀번호" maxlength="20"
                           style="width: 350px;" oninput="validateUserPw(this)" required/>
                    <span id="user_pw_error" style="color: #c20c0c;"></span>
                </td>
            </tr>
            <script>
                function validateUserPw(input) {
                    var regex = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*\W)(?=\S+$).{8,20}$/;
                    var errorMessage = "";

                    if (!regex.test(input.value)) {
                        errorMessage = "비밀번호를 확인해주세요";
                    }

                    document.getElementById('user_pw_error').innerText = errorMessage;
                }
            </script>

<!--            <tr>-->
<!--                <td>-->
<!--                </td>-->
<!--                <td>-->
<!--                    <span style="color: #999999; font-size: 2;">* 8~20자 영문 대 소문자, 숫자, 특수문자 모두 사용</span>&nbsp;-->
<!--                </td>-->
<!--            </tr>-->

            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_name">성명</label>
                    <label style="color: #c20c0c;">* </label>&nbsp;
                </td>
                <td>
                    <input class="font" type="text" id="user_name" name="user_name" placeholder="  성명"
                           style="width: 350px;"
                           oninput="validateUserName(this)" required/>
                    <span id="user_name_error" style="color: #c20c0c;"></span>
                </td>
            </tr>
            <script>
                function validateUserName(input) {
                    var regex = /^[가-힣a-zA-Z]+$/;
                    var errorMessage = "";

                    if (!regex.test(input.value)) {
                        errorMessage = "이름은 한글과 영문 대/소문자로만 입력 가능합니다.";
                    }

                    document.getElementById('user_name_error').innerText = errorMessage;
                }
            </script>

            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_gender">성별</label>
                    <label style="color: #c20c0c;">* </label>&nbsp;
                </td>
                <td style="text-align: center;">
                    남자 <input class="font" type="radio" id="user_gender" name="user_gender" value="남자" checked/>
                    여자 <input class="font" type="radio" id="user_gender" name="user_gender" value="여자"/>
                </td>
            </tr>

            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_address">주소</label>
                    <label style="color: #c20c0c;">* </label>&nbsp;
                </td>
                <td>
                    <input class="font" type="text" id="user_address" name="user_address" placeholder="  주소"
                           style="width: 350px;" required/>
                    <span style="color: #c20c0c;"></span>
                </td>
            </tr>

            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_email">이메일</label>
                    <label style="color: #c20c0c;">* </label>&nbsp;
                </td>
                <td>
                    <input class="font" type="text" id="user_email" name="user_email" placeholder="  이메일"
                           style="width: 350px;" required/>
                    <span id="user_email_message" style="color: #c20c0c;"></span>
                </td>
            </tr>
            <script>
                document.getElementById('user_email').addEventListener('blur', function() {
                    var userEmailInput = this.value;
                    var userEmailMessage = document.getElementById('user_email_message');

                    if (!/[^@]+@[^@]+\.[^.]+/.test(userEmailInput)) {
                        userEmailMessage.textContent = "올바른 이메일 형식이 아닙니다.";
                    } else {
                        userEmailMessage.textContent = "";
                    }
                });
            </script>
            <tr>
                <td style="text-align: right; width: 50px;">
                    <label for="user_phone">핸드폰 번호</label>
                    <label style="color: #c20c0c;">* </label>&nbsp;
                </td>
                <td>
                    <input class="font" type="text" id="user_phone" name="user_phone" placeholder="  핸드폰 번호"
                           style="width: 350px;" maxlength="13" oninput="validateUserPhone(this)" required/>
                    <span id="user_phone_error" style="color: #c20c0c;"></span>
                </td>
            </tr>
            <script>
                function validateUserPhone(input) {
                    // 숫자만 남기고 나머지 문자 제거
                    var phoneNumber = input.value.replace(/\D/g, '');

                    // 숫자가 없을 경우 빈 문자열 반환
                    if (phoneNumber === '') {
                        input.value = '';
                        return;
                    }

                    // 입력된 숫자가 전화번호 형식에 맞는지 확인
                    var formattedPhoneNumber = '';
                    if (phoneNumber.length >= 4) {
                        formattedPhoneNumber += phoneNumber.substring(0, 3) + '-';
                        if (phoneNumber.length >= 7) {
                            formattedPhoneNumber += phoneNumber.substring(3, 7) + '-';
                            if (phoneNumber.length >= 11) {
                                formattedPhoneNumber += phoneNumber.substring(7, 11);
                            } else {
                                formattedPhoneNumber += phoneNumber.substring(7);
                            }
                        } else {
                            formattedPhoneNumber += phoneNumber.substring(3);
                        }
                    } else {
                        formattedPhoneNumber = phoneNumber;
                    }

                    // 최대 입력 길이가 13을 넘지 않도록 제한
                    input.value = formattedPhoneNumber.substring(0, 13);
                }
            </script>
            <tr>
                <td style="text-align: right; width: 50px;">
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-secondary" type="submit">회원 등록</button>
                </td>
            </tr>
        </table>
        <br><br><br><br><br><br><br><br>

    </div>
</form>
<br>
<hr style="border: 1px solid gray; margin-top: 30px;">
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="company-info">
                <h3>My Online Shopping mall</h3>
                <p>3 Eunhaeng-ro, Yeongdeungpo-gu, Seoul, Republic of Korea (Konai, 9th floor, Exconventure Tower,
                    Yeouido-dong) | Email: han.ej@konai.com | Phone: 02-2168-7689</p>
            </div>
            <p>&copy; 2024 My Online Shop. All rights reserved.</p><br>
        </div>
    </div>
</footer>
</body>
</html>